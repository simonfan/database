define(["require","exports","module","lodash","q"],function(e,t,n){var r=e("lodash"),i=e("q");t.sync=function(t){var n=i.defer(),s=this.meta(),o=this.clientExec("id").toArray(),u={meta:s,loaded:o,criteria:this.criteria};return this.database.load(u,t).then(r.partial(n.resolve,this)),n.promise},t.exec=function(t,n){var s=i.defer(),o=this.sync(n);return o.then(r.bind(function(){var e=this.clientExec(t).toArray();s.resolve(e)},this)),s.promise},t.clientExec=function(t){var n=this.meta("sort-attributes"),r=this.meta("sort-directions"),i=this.meta("skip"),s=this.meta("limit");this.database.multisort(n,r);var o=this.database.find(this.criteria,t);return o=i?o.rest(i):o,o=s?o.take(s):o,o}});