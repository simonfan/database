//     BackboneCollectionLazy
//     (c) simonfan
//     BackboneCollectionLazy is licensed under the MIT terms.

//     subject
//     (c) simonfan
//     subject is licensed under the MIT terms.

//     Iterator
//     (c) simonfan
//     Iterator is licensed under the MIT terms.

//     Deep
//     (c) simonfan
//     Deep is licensed under the MIT terms.

//     Containers
//     (c) simonfan
//     Containers is licensed under the MIT terms.

//     ObjectMatcher
//     (c) simonfan
//     ObjectMatcher is licensed under the MIT terms.

//     backbone.collection.queryable
//     (c) simonfan
//     backbone.collection.queryable is licensed under the MIT terms.

//     comparator
//     (c)
//     comparator is licensed under the MIT terms.

//     BackboneCollectionMultisort
//     (c) simonfan
//     BackboneCollectionMultisort is licensed under the MIT terms.

//     lowercase-backbone
//     (c) simonfan
//     lowercase-backbone is licensed under the MIT terms.

//     database
//     (c) simonfan
//     database is licensed under the MIT terms.

var lazyJsName="function"==typeof define?"lazy":"lazy.js";define("backbone.collection.lazy",["backbone",lazyJsName],function(t,e){function r(t){n.prototype[t]=function(){var r=e(this.models),n=Array.prototype.slice.call(arguments);return r[t].apply(r,n)}}var n=t.Collection.extend({}),i=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];return e(i).each(r),n}),define("__subject/private/assign",["require","exports","module","lodash"],function(t,e,r){function n(t,e,r){if(o.defaults(r,a),!o.isArray(e))throw new Error("Currently subject.assign does not accept non-array properties for accessor assignment.");o.each(e,function(e){var n=o.extend({},r);n.get&&(n.get=o.partial(n.get,e)),n.set&&(n.set=o.partial(n.set,e)),Object.defineProperty(t,e,n)})}function i(t,e,r){o.defaults(r,s),o.each(e,function(e,n){var i=o.assign({value:e},r);Object.defineProperty(t,n,i)})}var o=t("lodash"),a={configurable:!0,enumerable:!0},s=o.extend({writable:!0},a);r.exports=function(t,e,r){return r?r.get||r.set?n(t,e,r):i(t,e,r):o.assign(t,e),t}}),define("__subject/public/assign-proto",["require","exports","module","lodash","../private/assign"],function(t,e,r){var n=t("lodash"),i=t("../private/assign");r.exports=function(){var t,e;return n.isObject(arguments[0])?(t=arguments[0],e=arguments[1]):n.isString(arguments[0])&&(t={},t[arguments[0]]=arguments[1],e=arguments[2]),i(this.prototype,t,e),this}}),define("__subject/public/proto-merge",["require","exports","module","lodash","../private/assign"],function(t,e,r){var n=t("lodash"),i=t("../private/assign");r.exports=function(){var t,e,r;if(n.isString(arguments[0])){var o=arguments[0];t=this.prototype[o],e=arguments[1],r=arguments[2],this.prototype[o]=i(n.create(t),e,r)}else r=arguments[1],n.each(arguments[0],n.bind(function(t,e){this.protoMerge(e,t,r)},this));return this}}),define("__subject/public/extend",["require","exports","module","lodash","../private/assign"],function(t,e,r){var n=t("lodash"),i=t("../private/assign");r.exports=function(t,e){var r,o=this;return r=function(){var t=n.create(r.prototype);return t.initialize.apply(t,arguments),t},i(r,n.pick(o,o.staticProperties),{enumerable:!1}),r.prototype=n.create(o.prototype),r.assignProto(t,e),i(r.prototype,{constructor:r,__super__:o.prototype},{enumerable:!1}),r}}),define("subject",["require","exports","module","lodash","./__subject/private/assign","./__subject/public/assign-proto","./__subject/public/assign-proto","./__subject/public/proto-merge","./__subject/public/extend"],function(t,e,r){var n=t("lodash"),i=t("./__subject/private/assign"),o=function(){};o.prototype=i({},{initialize:function(){}},{enumerable:!1}),i(o,{staticProperties:["proto","assignProto","protoMerge","staticProperties","assignStatic","extend"],assignStatic:function(t,e){return this.staticProperties=n.union(this.staticProperties,n.keys(t)),i(this,t,e)},assignProto:t("./__subject/public/assign-proto"),proto:t("./__subject/public/assign-proto"),protoMerge:t("./__subject/public/proto-merge"),extend:t("./__subject/public/extend")},{enumerable:!1}),r.exports=n.bind(o.extend,o);var a={assign:i};i(r.exports,a,{enumerable:!1,writable:!1,configurable:!1})}),define("iterator/base",["subject","lodash"],function(t,e){var r=t({initialize:function(t,e){this.data=t,e=e||{},this.currentIndex=e.startAt||-1,this.options=e,this.evaluate=e.evaluate||e.evaluator||this.evaluate},move:function(t){return this.index(this.currentIndex+t),this},evaluate:function(t){return t},evaluator:function(t){return this.evaluate=t,this},start:function(){return this.currentIndex=-1,this},end:function(){return this.currentIndex=this.length(),this},index:function(t){if(t>this.length()-1||0>t)throw new Error("No such index "+t);return this.currentIndex=t,this},countBefore:function(){return this.currentIndex+1},countAfter:function(){return this.length()-(this.currentIndex+1)},range:function(t,e){for(var r=[];e>=t;)r.push(this.at(t)),t++;return r},hasNext:function(){return this.currentIndex<this.length()-1},next:function(){return this.move(1),this.current()},nextN:function(t){for(var e=[],r=this.currentIndex+t-1;this.hasNext()&&this.currentIndex<=r;)e.push(this.next());return e},hasPrevious:function(){return this.currentIndex>0},previous:function(){return this.move(-1),this.current()},previousN:function(t){for(var e=[],r=this.currentIndex-t+1;this.hasPrevious()&&this.currentIndex>=r;)e.push(this.previous());return e},current:function(){return this.at(this.currentIndex)},value:function(){return this.data}});r.proto({hasPrev:r.prototype.hasPrevious,prev:r.prototype.previous,prevN:r.prototype.previousN});var n=["map","filter","compact","difference"];return e.each(n,function(t){r.proto(t,function(){var r=e(this.data);r=r[t].apply(r,arguments);var n=this.constructor(r.value());return n})}),r}),define("iterator/array",["require","exports","module","./base","lodash"],function(t){var e=t("./base"),r=t("lodash"),n=e.extend({at:function(t){return this.evaluate(this.data[t],t)},length:function(){return this.data.length}}),i=["push","reverse","shift","sort","splice","unshift"];return r.each(i,function(t){n.proto(t,function(){return this.data[t].apply(this.data,arguments),this})}),r.each(["concat","slice"],function(t){n.proto(t,function(){var e=this.data[t].apply(this.data,arguments);return this.constructor(e)})}),n}),define("iterator/object",["require","exports","module","./base","lodash"],function(t){var e=t("./base"),r=t("lodash"),n=e.extend({initialize:function(t,n){n=n||{},e.prototype.initialize.apply(this,arguments),this.order=n.order||r.keys(t)},keyAt:function(t){return this.order[t]},at:function(t){var e=this.keyAt(t),r=this.data[e];return this.evaluate(r,e)},length:function(){return this.order.length},nextKey:function(){return this.keyAt(this.currentIndex+1)},currentKey:function(){return this.keyAt(this.currentIndex)},previousKey:function(){return this.keyAt(this.currentIndex-1)},map:function(t){var e={};return r.each(this.order,function(r,n){e[r]=t(this.data[r],r,n)}.bind(this)),this.constructor(e)}});return n.proto("constructor",n),n}),define("itr",["require","exports","module","./iterator/array","./iterator/object","lodash"],function(t){var e=t("./iterator/array"),r=t("./iterator/object"),n=t("lodash"),i=function(t){var i;return n.isArray(t)?i=e:n.isObject(t)&&(i=r),i.apply(this,arguments)};return i.object=r,i.array=e,i}),define("__deep__/keys",["require","exports","module"],function(){return function(t){return t.replace(/\[(["']?)([^\1]+?)\1?\]/g,".$2").replace(/^\./,"").split(".")}}),define("__deep__/walker",["require","exports","module","lodash","itr","./keys"],function(t,e,r){var n=t("lodash"),i=t("itr"),o=t("./keys"),a=i.object.extend({nextStep:function(){var t=new RegExp("^"+this.currentKey()+"\\.");return this.nextKey().replace(t,"")},currentStep:function(){var t=new RegExp("^"+this.previousKey()+"\\.");return this.currentKey().replace(t,"")},previousStep:function(){var t=this.previousKey()||"";return n.last(t.split("."))},remainingSteps:function(){var t=new RegExp("^"+this.currentKey()+"\\.");return this.destination().replace(t,"")},destination:function(){return n.last(this.order)}});r.exports=function(t,e){e=n.isArray(e)?e:o(e);var r={"":t},i=[""];return n.every(e,function(o,a){var s=n.first(e,a+1).join(".");return i.push(s),t=t[o],r[s]=t,!n.isUndefined(t)}),a(r,{order:i})}}),define("__deep__/getset",["require","exports","module","lodash","./keys"],function(t,e){var r=t("lodash"),n=t("./keys");e.get=function(t,e){return e=r.isArray(e)?e:n(e),r.reduce(e,function(t,e){return t[e]},t)},e.set=function(t,i,o){i=r.isArray(i)?i:n(i);var a=i.pop();t=e.get(t,i),t[a]=o}}),define("deep",["require","exports","module","lodash","./__deep__/keys","./__deep__/walker","./__deep__/getset"],function(t){var e=t("lodash"),r={};return r.parseKeys=t("./__deep__/keys"),r.walker=t("./__deep__/walker"),e.extend(r,t("./__deep__/getset")),r}),define("containers",["lodash"],function(){function t(t,e){return _.all(e,function(e){return _.contains(t,e)})}function e(t,e){return _.any(e,function(e){return _.contains(t,e)})}function r(t,e){return t[0]<e&&e<t[1]}function n(t,e){return t[0]<=e&&e<=t[1]}function i(t,e,i){var o=i?r:n;return o=_.partial(o,t),_.isArray(e)?_.every(e,o):o(e)}return{containsAll:t,containsAny:e,exclusiveWithin:r,inclusiveWithin:n,within:i}}),define("__object-query__/operators/match",["require","exports","module","lodash"],function(t,e){var r=t("lodash");e.$matchSingle=function(t,e){return r.isRegExp(t)?t.test(e):t===e},e.$match=function(t,n){return r.isArray(n)?r.any(n,function(r){return e.$matchSingle(t,r)}):e.$matchSingle(t,n)}}),define("__object-query__/operators/range",["require","exports","module"],function(t,e){e.$lt=function(t,e){return t>e},e.$lte=function(t,e){return t>=e},e.$gt=function(t,e){return e>t},e.$gte=function(t,e){return e>=t}}),define("__object-query__/operators/set",["require","exports","module","lodash","containers"],function(t,e){var r=t("lodash"),n=t("containers");e.$in=function(t,e){return r.isArray(e)?n.containsAny(t,e):r.contains(t,e)},e.$nin=function(t,e){return r.isArray(e)?!n.containsAny(t,e):!r.contains(t,e)},e.$all=function(t,e){return n.containsAll(e,t)}}),define("__object-query__/operators/boolean",["require","exports","module"],function(t,e){e.$e=function(){},e.$ne=function(){},e.$not=function(){},e.$or=function(){},e.$and=function(){},e.$exists=function(){}}),define("__object-query__/operators/index",["require","exports","module","lodash","deep","containers","./match","./range","./set","./boolean"],function(t,e){var r=t("lodash");t("deep"),t("containers"),r.extend(e,t("./match"),t("./range"),t("./set"),t("./boolean")),e.evaluateValue=function(t,n){return r.isObject(t)&&!r.isRegExp(t)?r.every(t,function(t,r){var i=e[r];if(i)return i(t,n);throw new Error("The operator "+r+" is not supported by object-query.")}):e.$match(t,n)}}),define("__object-query__/match",["require","exports","module","lodash","deep","./operators/index"],function(t,e,r){var n=t("lodash"),i=t("deep"),o=t("./operators/index"),a=/[0-9]+/,s=function(t,e,r){return n.any(e,function(e){return u(t,e,r)})},u=r.exports=function(t,e,r){for(var u,c=i.walker(e,r);c.hasNext();){var l=c.next();if(!c.hasNext()){u=o.evaluateValue(t,l);break}if(n.isArray(l)&&!a.test(c.nextStep())){u=s(t,l,c.remainingSteps());break}}return u}}),define("__object-query__/find",["require","exports","module","lodash","deep","./operators/index"],function(t,e,r){var n=t("lodash"),i=t("deep"),o=t("./operators/index"),a=/[0-9]+/,s=function(t,e,r){return n.any(e,function(e){return u(t,e,r)})},u=r.exports=function(t,e,r){for(var u,c=i.walker(e,r);c.hasNext();){var l=c.next();if(!c.hasNext()){u=o.evaluateValue(t,l);break}if(n.isArray(l)&&!a.test(c.nextStep())){u=s(t,l,c.remainingSteps());break}}return u}}),define("object-query",["require","exports","module","lodash","./__object-query__/match","./__object-query__/find"],function(t){function e(t,e){return r.every(t,function(t,r){return n(t,e,r)})}var r=t("lodash"),n=t("./__object-query__/match");t("./__object-query__/find");var i=function(t){return t=t||{},r.partial(e,t)},o=["every","all","some","any","filter","find","reject"];return r.each(o,function(t){i[t]=function(e,n){return r[t](e,i(n))}}),i}),define("backbone.collection.queryable",["require","exports","module","backbone.collection.lazy","object-query","lodash"],function(t){var e=t("backbone.collection.lazy"),r=t("object-query"),n=t("lodash"),i=e.extend({find:function(t,e){var n=this,i=r(t),o=this.filter(function(t){return i(t.attributes)});return e?o.map(function(t){return n.project(t.attributes,e)}):o},findOne:function(t){var e=this.find(t).take(1).first();return e},project:function(t,e){if(n.isString(e))return t[e];if(n.isArray(e)){var r={};return n.each(e,function(e){r[e]=t[e]}),r}if(n.isObject(e)){var r={};return n.each(e,n.bind(function(e,n){r[n]=e===!0?t[n]:this.project(t[n],e)},this)),r}}});return i}),define("comparator",["lodash"],function(t){function e(t,e,r){return t===e?0:t>e?1*r:-1*r}var r=function(r,n,i){r=t.isString(r)?[r]:r,n=n||{},i=i||{};var o=i.root;return function(i,a){return i=o?i[o]:i,a=o?a[o]:a,t.reduce(r,function(r,o){if(0===r){var s=i[o],u=a[o],c=t.isNumber(n)?n:n[o]?n[o]:1;return e(s,u,c)}return r},0)}};return r}),define("backbone.collection.multisort",["backbone","comparator"],function(t,e){function r(t,e){return JSON.stringify({attributes:t,directions:e})}var n=t.Collection.extend({_multisortId:!1,isSorted:function(t,e){return this._multisortId===r(t,e)},multisort:function(t,n,i){var o=r(t,n);if(this._multisortId!==o){this.comparator=e(t,n,{root:"attributes"});{this.sort(i)}this._multisortId=o}return this}});return n}),define("lowercase-backbone",["require","exports","module","subject","backbone","lodash"],function(t,e,r){var n=t("subject"),i=t("backbone"),o=t("lodash"),a=r.exports={};a.model=n(i.Model.prototype),a.model.proto("initialize",function(t,e){var r=t||{};e||(e={}),this.cid=o.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(r=this.parse(r,e)||{}),r=o.defaults({},r,o.result(this,"defaults")),this.set(r,e),this.changed={}}),a.collection=n(i.Collection.prototype),a.collection.proto("initialize",function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),t&&this.reset(t,o.extend({silent:!0},e))}),a.view=n(i.View.prototype),a.view.proto("initialize",function(t){this.cid=o.uniqueId("view"),t||(t={}),o.extend(this,o.pick(t,viewOptions)),this._ensureElement(),this.delegateEvents()}),a.router=n(i.Router.prototype),a.router.proto(function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes()}),a.history=i.history}),define("__database/query-object/exec",["require","exports","module","lodash","q"],function(t,e){var r=t("lodash"),n=t("q");e.sync=function(t){var e=n.defer(),i=this.meta(),o=this.clientExec("id").toArray(),a={meta:i,loaded:o,criteria:this.criteria};return this.database.load(a,t).then(r.partial(e.resolve,this)),e.promise},e.exec=function(t,e){var i=n.defer(),o=this.sync(e);return o.done(r.bind(function(){var e=this.clientExec(t).toArray();i.resolve(e)},this)),i.promise},e.clientExec=function(t){var e=this.meta("sort-attributes"),r=this.meta("sort-directions"),n=this.meta("skip"),i=this.meta("limit");this.database.multisort(e,r);var o=this.database.find(this.criteria,t);return o=n?o.rest(n):o,o=i?o.take(i):o}}),define("__database/query-object/meta",["require","exports","module","lodash"],function(t,e){var r=t("lodash");e.meta=function(t,e){return 1===arguments.length?this.metaData[t]:2===arguments.length?(this.metaData[t]=e,this):0===arguments.length?r.clone(this.metaData):void 0},e.skip=r.partial(e.meta,"skip"),e.limit=r.partial(e.meta,"limit"),e.sortBy=function(t,e){if(r.isString(t)){var n=this.meta("sorting-attributes")||[],i=this.meta("sorting-directions")||{};n.push(t),i[t]=e,this.meta("sorting-attributes",n).meta("sorting-directions",i)}else r.isArray(t)&&this.meta("sorting-attributes",t).meta("sorting-directions",e);return this}}),define("__database/query-object/index",["require","exports","module","subject","lodash","./exec","./meta"],function(t,e,r){var n=t("subject"),i=t("lodash"),o=r.exports=n({initialize:function(t,e,r){this.database=t,this.criteria=i.clone(e),this.metaData=i.clone(r),this._syncedIntervals=[]}});o.assignProto(t("./exec")),o.assignProto(t("./meta"))}),define("__database/xhr",["require","exports","module","lodash"],function(t,e){var r=t("lodash");e.xhrOptions={},e.load=function(t,e){t=this.mapRequestData(t);var n=this.cache(t);if(n)return n;var i=r.extend({data:t,remove:!1},this.xhrOptions,e),o=this.fetch(i);return this.cache(t,o)},e.dataMap={},e.mapRequestData=function(t){return r.each(this.dataMap,function(e,r){var n=t[r];t[e]=n,delete t[r]}),t},e.cache=function(t,e){var r=JSON.stringify(t);return arguments.length<2?this._cache[r]:this._cache[r]=e},e.syncStatus=function(){}}),define("database",["require","exports","module","backbone.collection.queryable","backbone.collection.multisort","backbone.collection.lazy","lowercase-backbone","lodash","./__database/query-object/index","./__database/xhr"],function(t,e,r){var n=t("backbone.collection.queryable"),i=t("backbone.collection.multisort"),o=t("backbone.collection.lazy"),a=t("lowercase-backbone"),s=t("lodash"),u=t("./__database/query-object/index"),c=r.exports=a.collection.extend(o.prototype).extend(i.prototype).extend(n.prototype);c.assignProto({initialize:function(t,e){a.collection.prototype.initialize.apply(this,arguments),o.prototype.initialize.apply(this,arguments),i.prototype.initialize.apply(this,arguments),n.prototype.initialize.apply(this,arguments),s.assign(this,e),this.metaData=e.metaData||s.clone(this.metaData),this._cache={},this._queries={}},defaultQueryMeta:{limit:10,skip:0},query:function(t){t=t||{};var e=JSON.stringify(t),r=this._queries[e]||u(this,t,s.clone(this.defaultQueryMeta));return this._queries[e]=r,r}}),c.assignProto(t("./__database/xhr"))});